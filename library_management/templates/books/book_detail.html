{% extends "base.html" %}
{% block title %}{{ book.title }} - Details{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="bg-white rounded-lg shadow p-6 flex flex-col lg:flex-row gap-6">
        <!-- Book Image -->
        <div class="flex-shrink-0 w-full lg:w-1/3 flex items-center justify-center h-64 bg-indigo-50 rounded-lg">
            <span class="text-8xl">ðŸ“–</span>
        </div>

        <!-- Book Info -->
        <div class="flex-1 space-y-4">
            <h1 class="text-3xl font-bold text-gray-900">{{ book.title }}</h1>
            <p class="text-gray-700 text-lg">Author: {{ book.author }}</p>
            <p class="text-gray-500">ISBN: {{ book.isbn }}</p>
            <p class="text-gray-500">Published: {{ book.published_date|date:"Y-m-d" }}</p>
            <p class="text-gray-600">Copies Available: 
                <span class="{% if book.copies_available > 0 %}text-green-700{% else %}text-red-700{% endif %}">
                    {{ book.copies_available }}
                </span>
            </p>
            <p class="text-gray-700">{{ book.description|default:"No description available." }}</p>

            {% if user.is_authenticated %}
            <div class="flex space-x-2 mt-4">
                <button onclick="checkoutBook({{ book.id }})" {% if book.copies_available == 0 %}disabled aria-disabled="true"{% endif %}
                        class="px-4 py-2 rounded-md text-white font-medium {% if book.copies_available > 0 %}bg-indigo-600 hover:bg-indigo-700{% else %}bg-gray-400 cursor-not-allowed{% endif %}">
                    Borrow
                </button>
                <a href="{% url 'book-list' %}" class="px-4 py-2 rounded-md border border-gray-300 hover:bg-gray-50 text-gray-700">Back to List</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function checkoutBook(bookId) {
    fetch('/api/checkout/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': '{{ csrf_token }}' },
        body: JSON.stringify({ book_id: bookId })
    }).then(res => res.json()).then(data => {
        if(data.success){ alert('Book checked out!'); location.reload(); }
        else{ alert('Error: '+data.error); }
    }).catch(()=>alert('An error occurred.'));
}
</script>
{% endblock %}